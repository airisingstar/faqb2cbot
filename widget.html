<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>MyAiToolset Widget</title>
<style>
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;background:#fff;color:#0f172a}
  .chat-shell{display:flex;flex-direction:column;height:100vh}
  .chat-header{padding:12px 14px;background:#0f172a;color:#fff;font-weight:700}
  .chat-body{flex:1;overflow:auto;padding:12px;background:#f8fafc}
  .msg{margin:8px 0;display:flex;gap:10px}
  .bot .bubble{background:#e5e7eb;color:#0f172a;padding:10px 12px;border-radius:12px;max-width:85%}
  .user{justify-content:flex-end}
  .user .bubble{background:#3B82F6;color:#fff;padding:10px 12px;border-radius:12px;max-width:85%}
  .chat-input{display:flex;gap:8px;padding:12px;border-top:1px solid #e5e7eb;background:#fff}
  .chat-input input{flex:1;padding:12px 14px;border:1px solid #cbd5e1;border-radius:10px;font-size:16px}
  .chat-input button{padding:12px 16px;border:none;border-radius:10px;background:#3B82F6;color:#fff;font-weight:700;font-size:16px;cursor:pointer}
  .quick{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
  .chip{background:#0f172a;color:#fff;border:none;border-radius:999px;padding:8px 12px;font-size:14px;cursor:pointer}
</style>
</head>
<body>
<div class="chat-shell">
  <div class="chat-header">Virtual Assistant</div>
  <div class="chat-body" id="messages"></div>
  <form class="chat-input" id="chat-form">
    <input id="q" type="text" placeholder="Type your question‚Ä¶" autocomplete="off" />
    <button type="submit">Send</button>
  </form>
</div>

<script>
const API_BASE = location.origin;
const ASK_URL = API_BASE + "/ask";
const messages = document.getElementById('messages');
const form = document.getElementById('chat-form');
const q = document.getElementById('q');

// --- helpers ---
function addBot(text, html=false){
  const div=document.createElement('div');div.className='msg bot';
  const b=document.createElement('div');b.className='bubble';
  if(html){b.innerHTML=text;}else{b.textContent=text;}
  div.appendChild(b);messages.appendChild(div);messages.scrollTop=messages.scrollHeight;
}
function addUser(text){
  const div=document.createElement('div');div.className='msg user';
  const b=document.createElement('div');b.className='bubble';
  b.textContent=text;div.appendChild(b);messages.appendChild(div);messages.scrollTop=messages.scrollHeight;
}
function addQuickButtons(){
  const row=document.createElement('div');row.className='quick';
  const ask=document.createElement('button');ask.className='chip';ask.textContent='Ask a question';
  const sched=document.createElement('button');sched.className='chip';sched.textContent='Schedule an appointment';
  ask.onclick=(e)=>{e.preventDefault();send("I have a question");};
  sched.onclick=(e)=>{e.preventDefault();window.open("https://formspree.io/f/your_form_id","_blank");};
  row.appendChild(ask);row.appendChild(sched);messages.appendChild(row);
  messages.scrollTop=messages.scrollHeight;
}

// --- greet ---
addBot("Hi there üëã I'm your virtual assistant. Would you like to ask a question or schedule an appointment?");
addQuickButtons();

// --- send handler ---
form.addEventListener('submit',async(e)=>{
  e.preventDefault();
  const text=q.value.trim();
  q.value="";
  if(!text)return;
  addUser(text);

  // direct route to booking
  if(/\b(book|schedule|appointment)\b/i.test(text)){
    addBot("Sure! You can schedule instantly here:<br><a href='https://formspree.io/f/your_form_id' target='_blank'>Open appointment form</a>",true);
    addQuickButtons();
    return;
  }

  try{
    const res=await fetch(ASK_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:text})});
    const data=await res.json();
    addBot(data.answer || "I'm here to help!");
    addQuickButtons();
  }catch(err){
    addBot("‚ö†Ô∏è Sorry, something went wrong. Please try again later.");
  }
});
</script>
</body>
</html>
